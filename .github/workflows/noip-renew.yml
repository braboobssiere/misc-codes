name: Docker Deployment for NoIP Renew

on:
  workflow_dispatch:  

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout noip-renew repository
        run: |
          git clone https://github.com/neothematrix/noip-renew.git
          cd noip-renew

      - name: Set up environment variables
        run: |
          # Split the single secret into individual variables your_username;your_password;your_2fa_secret_key
          IFS=';' read -r ::add-mask::NOIP_USERNAME ::add-mask::NOIP_PASSWORD ::add-mask::NOIP_2FA_SECRET_KEY <<< "${{ secrets.NOIP_CREDENTIALS }}"
          echo "NOIP_USERNAME=${NOIP_USERNAME}" >> $GITHUB_ENV
          echo "NOIP_PASSWORD=${NOIP_PASSWORD}" >> $GITHUB_ENV
          echo "NOIP_2FA_SECRET_KEY=${NOIP_2FA_SECRET_KEY}" >> $GITHUB_ENV

      - name: Run Docker container
        run: |
          docker run --rm --network host -e 'NOIP_USERNAME=${{ env.NOIP_USERNAME }}' -e 'NOIP_PASSWORD=${{ env.NOIP_PASSWORD }}' -e 'NOIP_2FA_SECRET_KEY=${{ env.NOIP_2FA_SECRET_KEY }}' --shm-size=512m moebiuss/noip-renew
