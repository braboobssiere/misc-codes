<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCGPlayer Text to YDK Converter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        textarea {
            width: 100%;
            height: 200px;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>TCGPlayer Text to YDK Converter</h1>
    <form id="converterForm">
        <label for="fileInput">Select TCGPlayer text file:</label>
        <input type="file" id="fileInput" accept=".txt">
        <br><br>
        <label for="textInput">Or enter TCGPlayer text content:</label>
        <textarea id="textInput" placeholder="3 Pot of Prosperity&#10;1 Accesscode Talker&#10;2 Crossout Designator"></textarea>
        <br>
        <button type="submit">Convert to YDK</button>
    </form>
    <div id="downloadLinkContainer" style="display:none;">
        <a id="downloadLink" href="#" download="deck.ydk">Download YDK File</a>
    </div>

    <script>
        document.getElementById('converterForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('fileInput');
            const textInput = document.getElementById('textInput').value.trim();
            let inputText = '';

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = async (event) => {
                    inputText = event.target.result;
                    await processInput(inputText);
                };
                reader.readAsText(file);
            } else if (textInput) {
                inputText = textInput;
                await processInput(inputText);
            } else {
                alert('Please provide either a file or text input.');
            }
        });

        async function processInput(inputText) {
            const sections = inputText.split('\n\n').map(section => section.trim());
            const mainDeck = sections[0] ? sections[0].split('\n').map(line => line.trim()).filter(line => line) : [];
            const extraDeck = sections[1] ? sections[1].split('\n').map(line => line.trim()).filter(line => line) : [];
            const sideDeck = sections[2] ? sections[2].split('\n').map(line => line.trim()).filter(line => line) : [];

            const cardRequests = [...mainDeck, ...extraDeck, ...sideDeck].map(line => {
                const [quantity, ...cardNameParts] = line.split(' ');
                const cardName = cardNameParts.join(' ');
                return { quantity: parseInt(quantity), cardName };
            });

            const cardNames = cardRequests.map(card => encodeURIComponent(card.cardName)).join('|');
            const apiUrl = `https://db.ygoprodeck.com/api/v7/cardinfo.php?name=${cardNames}`;
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (data.success) {
                const ydkContent = generateYdkContent(data.data, cardRequests, mainDeck, extraDeck, sideDeck);
                createDownloadLink(ydkContent);
            } else {
                alert('Error fetching card data. Please check your input.');
            }
        }

        function generateYdkContent(cardData, cardRequests, mainDeck, extraDeck, sideDeck) {
            const ydkLines = [];
            ydkLines.push("#created by TCGPlayer Text to YDK Converter");

            const mainLines = [];
            const extraLines = [];
            const sideLines = [];

            cardRequests.forEach(request => {
                const cardInfo = cardData.find(card => card.name === request.cardName);
                if (cardInfo) {
                    const cardEntry = `${cardInfo.id}\n`.repeat(request.quantity).trim();
                    if (mainDeck.includes(request.cardName)) {
                        mainLines.push(cardEntry);
                    } else if (extraDeck.includes(request.cardName)) {
                        extraLines.push(cardEntry);
                    } else if (sideDeck.includes(request.cardName)) {
                        sideLines.push(cardEntry);
                    }
                }
            });

            ydkLines.push("#main");
            ydkLines.push(...mainLines);
            ydkLines.push("\n#extra");
            ydkLines.push(...extraLines);
            ydkLines.push("\n#side");
            ydkLines.push(...sideLines);

            return ydkLines.join('\n');
        }

        function createDownloadLink(content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const downloadLink = document.getElementById('downloadLink');
            downloadLink.href = url;
            document.getElementById('downloadLinkContainer').style.display = 'block';
        }
    </script>
</body>
</html>
